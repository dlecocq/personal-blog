---
layout: post
status: publish
published: true
title: Conditional Compilation
author:
  display_name: dan.lecocq
  login: dan.lecocq
  email: dan.lecocq@kaust.edu.sa
  url: http://dan.lecocq.us/wordpress
author_login: dan.lecocq
author_email: dan.lecocq@kaust.edu.sa
author_url: http://dan.lecocq.us/wordpress
wordpress_id: 983
wordpress_url: http://dan.lecocq.us/wordpress/?p=983
date: '2011-08-08 13:38:32 -0700'
date_gmt: '2011-08-08 20:38:32 -0700'
categories:
- computer science
tags:
- make
- autoconf
comments: []
---
<p>Last week I had the (dis)pleasure of porting some code to Mac, and today it came time to merge with the original codebase. As helpful as it was to use macros for different code paths, we needed something in the makefile to optionally add flags when compiling on Mac.<br />
<code><br />
&#47;&#47; This is all well and good<br />
#ifndef __APPLE__<br />
    &#47;&#47; Do your Linux-y includes here<br />
#else<br />
    &#47;&#47; Do your Apple-y includes here<br />
#endif<br />
<&#47;code></p>
<p>Apparently, there are a couple conventions for doing this. First, you can inject a configuration step (&agrave; la autoconf, for example) which would detect what platform you're building on in a robust way and build a Makefile for you. Second, if you're lazy or autoconf would be like hitting a fly with a hammer, you can use make's conditionals:<br />
<code><br />
# Ensure that this gets declared in time,<br />
# and fill it with the result of `uname`<br />
UNAME := $(shell uname)</p>
<p># If the environment is Darwin...<br />
ifeq ($(UNAME), Darwin)<br />
    CXXFLAGS = # Something Apple-y<br />
else<br />
    CXXFLAGS = # Something Linux-y<br />
endif<br />
<&#47;code></p>
<p>Simple enough!</p>
